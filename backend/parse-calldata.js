const { decodeAbiParameters } = require('viem');
const sig = "0x01D990393C670dCcE8b4d8F858FB98c9912dBFAa0600000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000001dbfff0cbd85cad62c8b602b812fdfd87bf06d1ab4951bfdad5b9c3bf2492c1d52acbdb52ade5c863d28752311c70dbbde8519cf64708dda350d0a31b1a96cb98000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000256781c66cf58e13839d48d1d454a52a806c7d137c9193a2856ec20d0b05d7e59d050000001200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000af7b2274797065223a22776562617574686e2e676574222c226368616c6c656e6765223a22304f5976355a4d6166773043616f77792d5667643646477a4f4f62794b6e58465166515163356953465949222c226f726967696e223a2268747470733a2f2f7265736f6e6174652d6465762d66726f6e74656e642d38323838363330383935362e6575726f70652d77657374312e72756e2e617070222c2263726f73734f726967696e223a66616c73657d0000000000000000000000000000000000";

console.log("Sig prefix:", sig.slice(0, 4));
console.log("Sig Length:", sig.length);

const modeByte = sig.slice(2, 4);
const validatorAddress = sig.slice(4, 44);
const innerSig = "0x" + sig.slice(44);

console.log("Mode:", modeByte);
console.log("Validator:", "0x" + validatorAddress);

try {
  const [authenticatorData, clientDataJSON, , r, s] = decodeAbiParameters(
    [
      { type: "bytes" },
      { type: "string" },
      { type: "uint256" },
      { type: "uint256" },
      { type: "uint256" },
      { type: "bool" },
    ],
    innerSig,
  );
  
  console.log("Successfully decoded inner WebAuthn sig directly!");
  console.log("ClientData:", clientDataJSON);
  console.log("r:", r.toString(16));
} catch (e) {
  console.error("Failed to decode inner:", e.message);
}
